<%- include('../partials/businessNavbar.ejs'); %>

<ul class="uk-breadcrumb uk-margin-large-left">
  <li>
    <a href="/business" class="uk-button uk-button-text noSelect">My Entries</a>
  </li>
  <li>
    <a href="/business/createentries" class="uk-button uk-button-text noSelect"
      >Create Entries</a
    >
  </li>
  <li>
    <a href="/business/reviewentries" class="uk-button uk-button-text noSelect"
      >Entries For Review</a
    >
  </li>
</ul>

<div
  class="
    uk-section uk-section-muted uk-section-entrydetail uk-section-large
    borderBottom
  "
>
  <div class="uk-container">
    <%- include('../partials/errors.ejs'); %>
    <h4 class="uk-text-uppercase uk-text-center uk-margin-top-large tagline1">
      <%- entry.name %>
    </h4>
    <hr />
    <div class="uk-clearfix uk-text-center">
      <span
        class="
          uk-label uk-float-center uk-label-danger uk-text-medium uk-text-bold
        "
        ><%- entry.typeOfVenue %></span
      >
      <span
        class="
          uk-label uk-float-center uk-label-primary uk-text-medium uk-text-bold
        "
        ><%- entry.bookingStatus %></span
      >
      <span
        class="
          uk-label uk-float-center uk-label-success uk-text-medium uk-text-bold
        "
        ><%- allReview.length != 0 ? 'User reviews' + ' ' + '-' + ' ' +  Math.round(totalScore/allReview.length) + '/' + '5' : 'No reviews' %>
      </span>
    </div>
    <hr class="uk-divider-icon" />

    <div>
      <div class="uk-slider-container-offset uk-margin-large-top" uk-slider>
        <div
          class="uk-position-relative uk-visible-toggle uk-light"
          tabindex="-1"
        >
          <ul class="uk-slider-items uk-child-width-1-1 uk-grid">
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.cover %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image1 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image2 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image3 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image4 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image5 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image6 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image7 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image8 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
            <li>
              <div class="uk-card-media-top">
                <img src="<%- entry.image9 %>" alt="<%- entry.cover %>" />
              </div>
            </li>
          </ul>
          <a
            class="uk-position-center-left uk-position-small uk-hidden-hover"
            href="#"
            uk-slidenav-previous
            uk-slider-item="previous"
          ></a>
          <a
            class="uk-position-center-right uk-position-small uk-hidden-hover"
            href="#"
            uk-slidenav-next
            uk-slider-item="next"
          ></a>
        </div>
        <ul class="uk-slider-nav uk-dotnav uk-flex-center uk-margin"></ul>
      </div>
    </div>
    
    <div class="uk-card uk-card-custom uk-card-hover uk-card-default">
      <div class="uk-card-body">
        <%- helper.getBusinessEntryUser(user,entry.user) %>
        
        <!-- edit -->
        <div id="editBusinessEntry" uk-modal>
            <div class="uk-modal-dialog uk-modal-body">
              <h2 class="uk-modal-title">Are you sure?</h2>
              <p>Go to the edit page</p>
              <span>
                <button
                  class="uk-button uk-button-default uk-modal-close noSelect"
                  type="button"
                >
                  Cancel
                </button>
              </span>
              <span
                ><a
                href="/business/myentries/entry/edit/<%- entry._id %>"
                class="uk-button uk-button-default  noSelect"
                type="button"
              >
                Edit
              </a></span
              >
            </div>
          </div>
          
        <!-- delete modal -->
        <div id="deleteBusinessEntry" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">Are you sure?</h2>
            <p>This entry will be deleted permanently!</p>
            <span>
              <button
                class="uk-button uk-button-default uk-modal-close noSelect"
                type="button"
              >
                Cancel
              </button>
            </span>
            <span
              ><form
                class="uk-float-right"
                action="/business/myentries/entry/delete/<%- entry._id %>"
                method="POST"
              >
                <input type="hidden" name="_method" value="DELETE" />
                <button
                  type="submit"
                  class="
                    uk-button uk-button-danger
                    noSelect
                    uk-margin-small-left
                  "
                >
                  Delete
                </button>
              </form></span
            >
          </div>
        </div>

        <ul uk-tab>
          <li><a href="#">Description</a></li>
          <li><a href="#">Hours</a></li>
          <li><a href="#">Location</a></li>
          <li><a href="#">Menus</a></li>
          <li><a href="#">Offers</a></li>
         
        </ul>

        <ul
          class="uk-switcher uk-margin"
          uk-switcher="animation: uk-animation-fade"
        >
          <li>
            <p class="uk-text-break"><%- entry.desc %></p>
          </li>
          <li>
            <table
              class="uk-table uk-table-striped uk-table-middle uk-table-divider"
            >
              <thead>
                <tr>
                  <th>Day</th>
                  <th>Open</th>
                  <th>Close</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>Monday</th>
                  <td><%- entry.monopening ? entry.monopening : "-" %></td>
                  <td><%- entry.monclose ? entry.monclose : "-" %></td>
                </tr>
                <tr>
                  <th>Tuesday</th>
                  <td><%- entry.tueopening ? entry.tueopening : "-" %></td>
                  <td><%- entry.tueclose ? entry.tueclose : "-" %></td>
                </tr>
                <tr>
                  <th>Wednesday</th>
                  <td><%- entry.wedopening ? entry.wedopening : "-" %></td>
                  <td><%- entry.wedclose ? entry.wedclose : "-" %></td>
                </tr>
                <tr>
                  <th>Thursday</th>
                  <td><%- entry.thuopening ? entry.thuopening : "-" %></td>
                  <td><%- entry.thuclose ? entry.thuclose : "-" %></td>
                </tr>
                <tr>
                  <th>Friday</th>
                  <td><%- entry.friopening ? entry.friopening : "-" %></td>
                  <td><%- entry.friclose ? entry.friclose : "-" %></td>
                </tr>
                <tr>
                  <th>Saturday</th>
                  <td><%- entry.satopening ? entry.satopening : "-" %></td>
                  <td><%- entry.satclose ? entry.satclose : "-" %></td>
                </tr>
                <tr>
                  <th>Sunday</th>
                  <td><%- entry.sunopening ? entry.sunopening : "-" %></td>
                  <td><%- entry.sunclose ? entry.sunclose : "-" %></td>
                </tr>
              </tbody>
            </table>
          </li>
          <li>
            <h1 class="uk-card-title">Address</h1>
            <p class="uk-text-break uk-margin">
              <span
                class="uk-margin-medium-right uk-text-success"
                uk-icon="icon: location; ratio: 2"
              ></span
              ><%- entry.location + ' ' + entry.postcode %>
            </p>
          </li>
          <li>
            <span
              class="uk-text-primary"
              uk-icon="icon:  file-pdf; ratio: 2"
            ></span>
            <a
              href="<%- entry.menu %>"
              target="_blank"
              class="uk-button uk-button-muted"
              ><%- entry.name + " " + "Menu" %></a
            >
          </li>
          <li><h1 class="uk-card-title uk-text-center">All Offers</h1>
            <div class="
            uk-child-width-1-1
            uk-child-width-1-3@s
            uk-grid-small
           
            uk-margin-large-top
            uk-margin-large-bottom
          "
          uk-grid>
          <% if(allOffers.length > 0) { %> <%
            allOffers.forEach((allOffer)=> { %>
                <div class="uk-card uk-card-hover uk-card-primary">
                    <div class="uk-card-body">
                        <h1 class="uk-card-title"><%- allOffer.offername %></h1>
                        <p class="uk-text-break"><%- allOffer.offerdesc %></p>
                        <p><%- 'Offer price:' + ' ' + '$ ' + allOffer.offeramount %></p>
                    </div>
                    <div class="uk-margin-bottom"><%- helper.getBusinessOfferUser(user,allOffer.user) %></div>
                   <!-- edit and delete modals -->
    <!-- edit -->
    <div id="editOffer" uk-modal>
        <div class="uk-modal-dialog uk-modal-body">
          <h2 class="uk-modal-title">Are you sure?</h2>
          <p>Go to the edit page</p>
          <span>
            <button
              class="uk-button uk-button-default uk-modal-close noSelect"
              type="button"
            >
              Cancel
            </button>
          </span>
          <span
            ><a
            href="/business/myentries/offer/edit/<%- allOffer._id %>"
            class="uk-button uk-button-default  noSelect"
            type="button"
          >
            Edit
          </a></span
          >
        </div>
      </div>
      <!-- delete modal -->
      <div id="deleteOffer" uk-modal>
        <div class="uk-modal-dialog uk-modal-body">
          <h2 class="uk-modal-title">Are you sure?</h2>
          <p>This offer will be deleted permanently!</p>
          <span>
            <button
              class="uk-button uk-button-default uk-modal-close noSelect"
              type="button"
            >
              Cancel
            </button>
          </span>
          <span
            ><form
              class="uk-float-right"
              action="/business/myentries/offer/delete/<%- allOffer._id %>"
              method="POST"
            >
              <input type="hidden" name="_method" value="DELETE" />
              <button
                type="submit"
                class="
                  uk-button uk-button-danger
                  noSelect
                  uk-margin-small-left
                "
              >
                Delete
              </button>
            </form></span
          >
        </div>
      </div>

                </div>
                <% }) %> <% } else { %>
                    <p class="uk-text-center uk-text-large uk-text-warning">No Offers</p>
                    <% } %>
            </div></li>
        </ul>
      </div>
    </div>

    
    <!-- form -->
    <div class="
    uk-child-width-1-1
    uk-child-width-1-2@s
    uk-grid-small
    uk-margin-large-top
    uk-margin-large-bottom
  "
  uk-grid>
        <div class="uk-card uk-card-hover uk-card-default uk-margin-top">
            <div class="uk-card-body">
              <h1 class="uk-card-title uk-text-center">Add reviews</h1>
              <form action="/userreviews/<%- entry._id %>" method="POST">
                <div class="uk-form-stacked">
                  <div class="uk-margin-small">
                    <div class="uk-form-control">
                      <input
                        required
                        type="number"
                        name="userScore"
                        min="1"
                        max="5"
                        placeholder="Initial score out of 5"
                        id="rating"
                        class="uk-input uk-form-large noSelect"
                      />
                    </div>
                    <div class="uk-form-control">
                      <textarea
                        required
                        class="uk-textarea"
                        name="userComment"
                      ></textarea>
                    </div>
                  </div>
                  <div class="uk-marign-medium uk-text-center">
                    <div class="uk-form-control">
                      <button
                        type="submit"
                        class="uk-button uk-button-custom noSelect"
                      >
                        Post review
                      </button>
                    </div>
                  </div>
                </div>
              </form>
              <hr class="uk-divider-icon" />
              <p class="uk-text-lead uk-text-bold uk-text-center@s">
                Total Reviews: <%- allReview.length %>
              </p>
      
              <p class="uk-text-headline uk-text-secondary uk-text-center@s">
                <%- allReview.length != 0 ? 'Total Score:'+ ' ' +  Math.round(totalScore/allReview.length)+ '/'+ '5': 'Total Score:' + ' ' + '0' %>
              </p>
              <p class="uk-text-meta uk-text-success uk-text-normal uk-text-center@s">
                Based on <%- allReview.length%> customer reviews
              </p>
              <ul class="uk-comment-list">
                <% allReview.forEach(review => { %>
                <li>
                  <article
                    class="
                      uk-comment
                      uk-visible-toggle
                      uk-padding-small
                      uk-box-shadow-small
                    "
                    tabindex="-1"
                  >
                    <header class="uk-comment-header uk-position-relative">
                      <div class="uk-grid-medium uk-flex-middle" uk-grid>
                        <div class="uk-width-expand">
                          <p class="uk-comment-title uk-margin-remove">
                            <p class="uk-margin--medium-right"
                              ><%- review.user.name %></p
                            >
                            <span
                              class="
                                uk-text-bold uk-text-success uk-marign-medium-left
                              "
                              >gave - <%- review.userScore %> / 5</span
                            >
                          </p>
                          <p class="uk-comment-meta uk-margin-remove-top">
                            <a class="uk-link-reset" href="#"
                              ><%- helper.formatDate(review.createdAt, 'LL') %></a
                            >
                          </p>
                        </div>
                      </div>
                    </header>
                    <div class="uk-comment-body">
                      <p class="uk-text-break"><%- review.userComment %></p>
                    </div>
                  </article>
                </li>
                <% }) %>
              </ul>
            </div>
          </div>
          <div class="uk-card uk-card-hover uk-card-default uk-margin-top">
            <div class="uk-card-body">
              <h1 class="uk-card-title uk-text-center">Add Offers</h1>
              <form action="/business/createoffer/<%- entry._id %>" method="POST">
                <div class="uk-form-stacked">
                    <div class="uk-margin-small">
                        <div class="uk-form-control">
                            <input class="uk-input uk-form-large noSelect" required type="text" name="offername" 
                            placeholder="Title of offer"  value="<%= typeof offername != 'undefined' ? offername : '' %>" />
                        </div>
                        <div class="uk-form-control uk-margin-small-top">
                            <label for="desc" class="uk-text-meta"
                              >Full Description of the offer.</label
                            >
                            <textarea
                              required
                                
                              name="offerdesc"
                              class="uk-textarea"
                            ></textarea
                            >
                          </div>
                          <div class="uk-form-control">
                            <input
                              required
                              type="number"
                              name="offeramount"
                              id="offeramount"
                              placeholder="Enter offer amount in USD"
                              class="uk-input uk-form-large noSelect"
                              value="<%= typeof offeramount != 'undefined' ? offeramount: '' %>"
                            />
                          </div>
                    </div>
                    <div class="uk-margin-medium uk-text-center">
                        <div class="uk-form-control">
                            <button
                              type="submit"
                              class="uk-button uk-button-custom noSelect"
                            >
                              Post
                            </button>
                          </div>
                    </div>
                </div>
            </form>
            </div>
          </div>
    </div>
    
  </div>
</div>
